---
title: "Actividad_1_Representación_gráfica_datos"
author: "Mirkka Puente Madrid"
date: "`r format(Sys.Date())`"
output:
  html_document:
    theme: cosmo
    toc: true
    toc_float: true
    number_sections: true
    highlight: tango
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  message = FALSE,  # oculta mensajes (como los de cargar librerías)
  warning = FALSE,  # oculta warnings
  echo = TRUE       
)
```

# Representación gráfica de datos e interpretación de resultados

Visualización de datos biológicos y análisis estadístico de un dataset que contiene información de la expresión de 40 genes en 65 pacientes con cáncer de mama, cada uno con distintos tipos de tratamiento y características tumorales.

El objetivo principal es interpretar los datos mediante la generación de gráficos y dar respuesta a preguntas específicas.

### Preguntas

**1. Ten en cuenta los siguientes genes: "AQ_ESR1", "AQ_HER2", "AQ_BRCA1", "AQ_BRCA2", "AQ_MKI67", "AQ_GATA3", "AQ_FOXA1", "AQ_CCND1", "AQ_CDH1", "AQ_TP53":**

-   Para responder este ejercicio, apóyate en un diagrama de cajas en el que visualices por cada expresión de gen 2 cajas: 1 para trata y otro para tratB.

#### Gráfico de Boxplots

```{r boxplots, fig.width=7, fig.height=7, fig.align='center', out.width="50%", include=TRUE}
#Remover todas las variables creadas en environment so far
rm(list=ls())
setwd("C:/Users/User/Desktop/UNIR/Estadistica_R/Statistics_and_R")

#Save the data in our environment
file <- "MUBioinfo_dataset_genes_oct2025.csv"
df <- read.csv(file, fileEncoding="UTF-8-BOM", check.names=FALSE)

#Install libraries
#install.packages(c("ggplot2", "dplyr", "patchwork"))

library(ggplot2)
library(dplyr)
library(patchwork)

#### ---- Box plots ---- ####
#Seleccionar las columnas que quiero usar
genes <- c("AQ_esr1", "AQ_her2", "AQ_brca1", "AQ_brca2", "AQ_mki67", "AQ_gata3", "AQ_foxa1", "AQ_ccnd1", "AQ_cdh1", "AQ_tp53")

df_q1 <- df %>%
  select(tratamiento, all_of(genes))

#Grafico de los boxplots

list_boxplots <- list()  #lista de graficos
indice <- 1              #indice en la lista

for (gen in genes) {
  bp <- ggplot(df_q1, aes(x = tratamiento, y = .data[[gen]], fill = tratamiento)) + 
    geom_boxplot(
      outlier.color = "black",
      outlier.size = 2,
      width = 0.5
    ) +
    geom_jitter(  #puntos en los boxplots
      aes(color = tratamiento),
      width = 0.1,   
      height = 0,    
      size = 0.3,   
      alpha = 1,   
    ) +
    labs(
      title = paste0("Expresión del ", gen),
      x = "Tratamientos",
      y = expression("AQ (2"^-Delta * "Ct)")
    ) +
    scale_fill_manual(values = c("mistyrose", "lightblue")) +
    theme_minimal() +
    theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 12))
  
  list_boxplots[[indice]] <- bp
  indice <- indice + 1
  rm(bp)
}

#Combina todos los plots en una hoja
combined_boxplot <- wrap_plots(list_boxplots, ncol = 2) 

combined_boxplot

```

-   ¿Qué interpretación sacas de la distribución de la expresión de los genes cuando los comparamos por tipo de tratamiento?

La distribución de la expresión de los genes muestra que todos los genes evaluados presentan mayor expresión en el tratamiento con placebo en comparación con el tratamiento con fármaco. En los diagramas de cajas, los pacientes bajo tratamiento farmacológico muestran expresión génica con valores de AQ cercanos a 0, lo que indica ausencia de transcripción o expresión muy baja. Sin embargo, los pacientes bajo el tratamiento con placebo muestran expresión génica con valores aproximados a 0.9 en mediana, lo que indica una actividad génica claramente superior.

El patrón observado se dá en genes asociados a desarrollo y diferenciación celular (ESR1, FOXA1, GATA3, CDH1), proliferación y ciclo celular (HER2, MKI67, CCND1) y reparación del ADN y apoptosis (BRCA1, BRCA2, TP53). Estos resultados sugieren que el fármaco está reprimiendo la transcripción de los genes estudiados. Podría ser que exista una reducción en la proliferación de células cancerígenas o reducción en procesos celulares asociados a los tumores.

**2. Ten en cuenta los siguientes parámetros bioquímicos para toda la población: "glucosa", "leucocitos", "linfocitos", "neutrofilos", "chol", "hdl", "hierro", "igA", "igE", "igG", "igN", "ldl", "pcr", "transferrina", "trigliceridos", "cpk":**

-   Para responder este ejercicio, apóyate en un histograma en el que se visualice la frecuencia de cada variable, utilizando aproximadamente 30 bins (a mayor bins, mayor número de barras).

#### Gráficos de Histogramas

```{r histogramas, fig.width=12, fig.height=8, fig.align='center', out.width="90%", include=TRUE}
#Remover todas las variables creadas en environment so far
rm(list=ls())
setwd("C:/Users/User/Desktop/UNIR/Estadistica_R/Statistics_and_R")

#Save the data in our environment
file <- "MUBioinfo_dataset_genes_oct2025.csv"
df <- read.csv(file, fileEncoding="UTF-8-BOM", check.names=FALSE)

#Install libraries
#install.packages(c("ggplot2", "dplyr", "patchwork"))
#install.packages()

library(ggplot2)
library(dplyr)
library(patchwork)


#### ---- Histogramas ---- ####
#Seleccionar las columnas con las que voy a trabajar
parametros_bio <- c("glucosa", "leucocitos", "linfocitos", "neutrofilos", "chol", "hdl", "hierro", "iga", "ige", "igg", "ign", "ldl", "pcr", "transferrina", "trigliceridos", "cpk")

df_q2 <- df %>% select(all_of(parametros_bio))

list_hist <- list()
i <- 1

for (parametro in parametros_bio) {
  h <- ggplot(df_q2) +
    geom_histogram(
      aes(x = .data[[parametro]], y = after_stat(density)),
      color = "darkblue",
      fill = "lavender",
      position = "identity",
      bins = 30
    ) +
    geom_density(
      aes(x = .data[[parametro]], y = after_stat(density)),
      lwd = 0.5,
      colour = 6,
      fill = 6,
      alpha = 0.15
    ) +
    labs(
      title = paste0("Distribución de ", toupper(parametro)),
      x = parametro,
      y = "Frecuencia"
    ) +
    theme_minimal() +
    theme(plot.title = element_text(hjust = 0.5, face = "bold"))
  
  list_hist[[i]] <- h
  i <- i + 1
  rm(h)
}

#Combina todos los plots en una hoja
combined_hist <- wrap_plots(list_hist, ncol = 4) 

combined_hist

```

-   ¿Qué interpretación sacas de la distribución de los datos de las variables bioquímicas en toda la población?

La distribuición de datos de las variables bioquímicas no siguen una distribución normal. En la mayoría de distribuciónes se observa un sesgo marcado a la derecha, especialmente en PCR, neutrófilos, IgN y triglicéridos, lo que nos indica que la mayoría de los pacientes tienen valores bioquímicos relativamente bajos en las variables estudiadas. Este comportamiento es esperado para biomarcadores asociados al cáncer: inflamación y respuesta inmune en pacientes enfermos.

Los datos tan asimétricos nos indican que antes de analizarlos deberíamos transformar los datos (estandarizarlos o utilizar una transformación log) para luego poder realizar pruebas de hipótesis o análisis de datos.

-   ¿Crees que sigue una distribución normal o simétrica en la que se visualiza una distribución parecida a una campana de Gauss?

En la mayoría de las variables no se observa una distribución en forma similar a la campana de Gauss.

Una distribución más parecida a la campana de Gauss se observa en el gráfico de transferrina que es una proteína que ayuda en el transporte de hierro en la sangre. Aunque incluso en esta gráfica se observan outliers importantes. Esta forma de campana es solo una impresión. Puede que siga una distribución normal, sin embargo, no podemos estar seguros hasta realizar una prueba formal de normalidad ya que la forma no garantiza que los datos estén en distribución normal.

**3. Mapea todos los valores de expresión de genes para poder visualizar posibles patrones entre los datos de los pacientes:**

-   Para responder esta pregunta, apóyate en un heatmap en el que visualices los datos crudos de todas las variables AQ (expresión de genes).

#### Gráfico de Heatmap

```{r heatmap, include=TRUE}

#Remover todas las variables creadas en environment so far
rm(list = ls())
setwd("C:/Users/User/Desktop/UNIR/Estadistica_R/Statistics_and_R")

#Save the data in our environment
file <- "MUBioinfo_dataset_genes_oct2025.csv"
df <- read.csv(file, fileEncoding = "UTF-8-BOM", check.names = FALSE)

# Instalación
pack_list <- c("BiocManager",
               "ComplexHeatmap",
               "circlize",
               "ggplot2",
               "dplyr",
               "patchwork")

for (pack in pack_list) {
  if (!requireNamespace(pack, quietly = TRUE))
    install.packages(pack)
}


# Cargar
library(ggplot2)
library(dplyr)
library(patchwork)
library(ComplexHeatmap)
library(grid)
library(circlize)

#Seleccionar solo las columnas de genes
df_q3 <- df %>% select(starts_with("AQ_"))
mat_q3 <- t(df_q3)  # transponer las columnas con filas
mat_q3_escala <- t(scale(t(mat_q3))) #datos escalados

### --------  Heatmap  ---------------
# anotación para tener informacion de pacientes

tipo_tumor <- df$extension

tumor <- HeatmapAnnotation(Extension_tumor = tipo_tumor,
                           col = list(
                             Extension_tumor = c(
                               "localizado" = "#FFE7BA",
                               "metastasico" = "#C1FFC1"
                             )
                           ))

#Definir colores del heatmap
colores_heatmap <- colorRamp2(c(-2, -1, 0, 1, 2),
                              c("blue", "lightblue", "white", "mistyrose", "lightpink"))

#Semilla
set.seed(1995)

#Grafico de heatmap
Heatmap(
  mat_q3_escala,
  top_annotation = tumor,
  row_km = 3,
  column_km = 1,
  row_gap = unit(3, "mm"),
  row_names_gp = gpar(fontsize = 8),
  col = colores_heatmap,
  heatmap_legend_param = list(
    title = "Expresión Estandarizada",
    at = c(-2, 0, 2),
    labels = c("Baja", "Media", "Alta")
  )
)

```

-   ¿Hay algún tipo de patrón de pacientes que tiene la expresión de genes similar o diferenciada?

El patrón que se puede observar es que los pacientes con tumores metastásicos tienen a agruparse en un mismo segmento del dendograma de columnas, lo que indica que comparten un perfil de expresión génica más parecido entre sí y claramente diferente al de pacientes con tumores localizados. Los pacientes con tumores metastásicos muestran niveles de expresión génica altos (tonos rosados) en el segundo clúster de genes (filas), mientras que los pacientes con tumores localizados muestran baja expresión génica (tonos azules) en éstos genes.

Los genes del segundo clúster en filas incluye genes asociados a la inflamación, señalización inmune, regulación positiva de expresión génica y regulación positiva de la proliferación de células (i.e. IL6, ACTB, EGFR, VEGFA). Es decir, los pacientes con metástasis tienen una expresión génica más alta de genes relacionados con proliferación celular y su diseminación.

El heatmap nos confirma que existe un patrón en la expresión de genes al diferenciar a pacientes con extensión tumoral metastásica de pacientes con extensión tumoral localizada.

-   ¿Hay grupos de genes con patrones de expresión similares o diferenciadas?

Sí hay genes con patrones de expresión similar que se agrupan bien en los tres clústers. En el clúster 1, en la parte superior, su expresión es relativamente baja y están asociados a funciones biológicas como la proliferación celular y la regulación positiva de la trasncripción de ADN. En el segundo clúster (medio), la mayoría de genes participan en respuestas inflamatorias y se puede apreciar claramente que pacientes con tumores metastásicos muestran alta expresión de estos genes. En el tercer clúster, la expresión es variable. La expresión de ciertos genes es alta en ciertos pacientes y muy baja en otros. Los genes agrupados en este clúster comparten funciones biológicas como el proceso de apoptósis, la regulación de la estabilidad de protínas y la respuesta a factores de crecimiento. En conclusión, existen grupos de genes con patrones de expresión similares, y el clúster del medio es el más diferencial y relevante.
